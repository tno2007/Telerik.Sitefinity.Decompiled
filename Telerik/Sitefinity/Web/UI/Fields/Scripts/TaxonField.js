Type.registerNamespace("Telerik.Sitefinity.Web.UI.Fields");
Telerik.Sitefinity.Web.UI.Fields.TaxonField=function(element){this._element=element;
this._webServiceUrl=null;
this._taxonomyId=null;
this._taxonomyProvider=null;
this._bindOnServer=false;
this._allowCreating=null;
this._allowMultipleSelection=null;
this._initialTaxaCount=0;
this._selectedTaxa=[];
this._selectedIds=[];
this._selectedTaxaBinder=null;
this._originalValue=[];
this._clientManager=null;
this._enabled=null;
this._removeSelectedTaxonDelegate=null;
this._selectedTaxaBinderItemCommandDelegate=null;
Telerik.Sitefinity.Web.UI.Fields.TaxonField.initializeBase(this,[element]);
};
Telerik.Sitefinity.Web.UI.Fields.TaxonField.prototype={initialize:function(){this._clientManager=new Telerik.Sitefinity.Data.ClientManager();
if(this._removeSelectedTaxonDelegate==null&&typeof this._removeSelectedTaxonClicked==="function"){this._removeSelectedTaxonDelegate=Function.createDelegate(this,this._removeSelectedTaxonClicked);
}if(this._selectedTaxaBinderItemCommandDelegate==null){this._selectedTaxaBinderItemCommandDelegate=Function.createDelegate(this,this._selectedTaxaBinderItemCommand);
}this._selectedTaxaBinder.add_onItemCommand(this._selectedTaxaBinderItemCommandDelegate);
Telerik.Sitefinity.Web.UI.Fields.TaxonField.callBaseMethod(this,"initialize");
},dispose:function(){this._webServiceUrl=null;
this._taxonomyId=null;
this._taxonomyProvider=null;
this._allowMultipleSelection=null;
if(this._removeSelectedTaxonDelegate!=null){delete this._removeSelectedTaxonDelegate;
}if(this._selectedTaxaBinderItemCommandDelegate!=null){this._selectedTaxaBinder.remove_onItemCommand(this._selectedTaxaBinderItemCommandDelegate);
delete this._selectedTaxaBinderItemCommandDelegate;
}Telerik.Sitefinity.Web.UI.Fields.TaxonField.callBaseMethod(this,"dispose");
},add_taxonAdded:function(delegate){this.get_events().addHandler("taxonAdded",delegate);
},remove_taxonAdded:function(delegate){this.get_events().removeHandler("taxonAdded",delegate);
},add_taxonRemoved:function(delegate){this.get_events().addHandler("taxonRemoved",delegate);
},remove_taxonRemoved:function(delegate){this.get_events().removeHandler("taxonRemoved",delegate);
},addTaxon:function(taxon,dontBind){var alreadyAddedTaxon=this._getTaxon(taxon.Id);
if(alreadyAddedTaxon){alreadyAddedTaxon.Title=taxon.Title;
}else{this._selectedTaxa.push(taxon);
}this._selectedIds=null;
if(!this._allowMultipleSelection){this._selectedTaxa=[];
this._selectedTaxa.push(taxon);
}if(dontBind!=true){var data={Items:this._selectedTaxa};
this._selectedTaxaBinder.BindCollection(data);
}this._taxonAddedHandler(taxon.Title,taxon.Id);
},removeTaxon:function(taxonTitle,taxonId){this._selectedIds=null;
var selectedTaxaLength=this._selectedTaxa.length;
for(var i=0;
i<selectedTaxaLength;
i++){if(this._selectedTaxa[i].Title==taxonTitle&&this._selectedTaxa[i].Id==taxonId){this._selectedTaxa.splice(i,1);
break;
}}var data={Items:this._selectedTaxa};
this._selectedTaxaBinder.BindCollection(data);
this._taxonRemovedHandler(taxonTitle,taxonId);
},loadTaxa:function(taxonIds){alert("This method nees to be implemented on the concrete implementation of the taxon field!");
},reset:function(){for(var i=0;
i<this._selectedTaxa.length;
i++){this.removeTaxon(this._selectedTaxa[i].Title,this._selectedTaxa[i].Id);
}this._selectedIds=[];
this._selectedTaxa=[];
Telerik.Sitefinity.Web.UI.Fields.TaxonField.callBaseMethod(this,"reset");
},_taxonAddedHandler:function(taxonTitle,taxonId){var eventArgs={Title:taxonTitle,Id:taxonId};
var h=this.get_events().getHandler("taxonAdded");
if(h){h(this,eventArgs);
}return eventArgs;
},_taxonRemovedHandler:function(taxonTitle,taxonId){var eventArgs={Title:taxonTitle,Id:taxonId};
var h=this.get_events().getHandler("taxonRemoved");
if(h){h(this,eventArgs);
}return eventArgs;
},_selectedTaxaBinderItemCommand:function(sender,eventArgs){if(this._enabled){var dataItem=eventArgs.get_dataItem();
if(eventArgs.get_commandName()=="remove"){this.removeTaxon(dataItem.Title,dataItem.Id);
}}},_getSelectedTaxaIds:function(){if(this._selectedIds){return this._getSelectedIds(this._selectedIds);
}this._selectedIds=[];
var selectedTaxaCount=this._selectedTaxa.length;
while(selectedTaxaCount--){var id=this._selectedTaxa[selectedTaxaCount].Id;
this._selectedIds.push(id);
}return this._getSelectedIds(this._selectedIds);
},_getSelectedIds:function(selectedIds){if(this._allowMultipleSelection){return selectedIds;
}else{if(selectedIds.length>0){return[selectedIds[0]];
}}return null;
},_getTaxon:function(taxonId){var selectedTaxaCount=this._selectedTaxa.length;
while(selectedTaxaCount--){if(this._selectedTaxa[selectedTaxaCount].Id===taxonId){return this._selectedTaxa[selectedTaxaCount];
}}return null;
},get_webServiceUrl:function(){return this._webServiceUrl;
},set_webServiceUrl:function(value){this._webServiceUrl=value;
},get_taxonomyId:function(){return this._taxonomyId;
},set_taxonomyId:function(value){this._taxonomyId=value;
},get_taxonomyProvider:function(){return this._taxonomyProvider;
},set_taxonomyProvider:function(value){this._taxonomyProvider=value;
},get_bindOnServer:function(){return this._bindOnServer;
},set_bindOnServer:function(value){this._bindOnServer=value;
},get_allowMultipleSelection:function(){return this._allowMultipleSelection;
},set_allowMultipleSelection:function(value){this._allowMultipleSelection=value;
},get_allowCreating:function(){return this._allowCreating;
},set_allowCreating:function(value){this._allowCreating=value;
},get_selectedTaxa:function(){return this._selectedTaxa;
},get_selectedTaxaBinder:function(){return this._selectedTaxaBinder;
},set_selectedTaxaBinder:function(value){this._selectedTaxaBinder=value;
},isChanged:function(){if(this._originalValue==null){this._originalValue=[];
}var maxi=0;
var changed=false;
if(this.get_value()!=null){if(this._originalValue.length==this.get_value().length){while(this._originalValue[maxi]){var originalValue=this._originalValue[maxi];
var found=false;
var i=0;
while(this.get_value()[i]){var currentValue=this.get_value()[i];
if(originalValue==currentValue){found=true;
break;
}i++;
}if(found==false){changed=true;
break;
}maxi++;
}}else{changed=true;
}}return changed;
},get_value:function(){return this._getSelectedTaxaIds();
},set_value:function(value){value=Telerik.Sitefinity.fixArray(value);
this._originalValue=value;
this._selectedIds=value;
if(value!=null&&value.length>0){this._doExpandHandler();
this.loadTaxa(value);
}},get_defaultValue:function(){if(this._allowMultipleSelection){return[];
}return"";
},get_culture:function(){this._clientManager.get_culture();
},set_culture:function(culture){this._clientManager.set_culture(culture);
},get_uiCulture:function(){this._clientManager.get_uiCulture();
},set_uiCulture:function(culture){if(culture&&this._clientManager.get_uiCulture()!==culture){this._clientManager.set_uiCulture(culture);
this._selectedTaxaBinder.set_uiCulture(culture);
if(this._getSelectedTaxaIds()&&this._getSelectedTaxaIds().length){this.loadTaxa(this._getSelectedTaxaIds());
}}}};
Telerik.Sitefinity.Web.UI.Fields.TaxonField.registerClass("Telerik.Sitefinity.Web.UI.Fields.TaxonField",Telerik.Sitefinity.Web.UI.Fields.FieldControl,Telerik.Sitefinity.Web.UI.Fields.ILocalizableFieldControl);
